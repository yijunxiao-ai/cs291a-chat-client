(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],{53:function(e,t,a){e.exports=a(82)},58:function(e,t,a){},59:function(e,t,a){},82:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(19),o=a.n(r),l=(a(58),a(10)),i=a(11),c=a(15),u=a(12),h=a(5),d=a(16),m=a(32),g=a(21),v=a(24),S=a(17),b=a(28),p=a(27),f=(a(59),a(29)),E=a(33),y=a(7),O={login:function(e,t,a){var n=new FormData;return n.append("username",t),n.append("password",a),fetch("".concat(e,"/login"),{method:"POST",body:n}).then(j)},message:function(e,t,a){var n=new FormData;return n.append("message",t),fetch("".concat(e,"/message"),{method:"POST",body:n,headers:{Authorization:"Bearer ".concat(a)}})}};function j(e){if(e.ok)return e.json().then((function(e){return e.token}));403===e.status?alert("Invalid username or password"):alert(e.status+" failure to /login")}var w=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={server:"http://0.0.0.0:3000",username:"",password:""},a.handleChange=a.handleChange.bind(Object(h.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"handleChange",value:function(e){this.setState(Object(f.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),console.log("Try log in as ",this.state.username),O.login(this.state.server,this.state.username,this.state.password).then((function(e){console.log("Get token = ",e),void 0!==e&&(sessionStorage.url=t.state.server,sessionStorage.token=e,sessionStorage.user=t.state.username,t.props.startStream())})),this.setState({password:""})}},{key:"render",value:function(){return s.a.createElement(S.a,{show:this.props.show},s.a.createElement(S.a.Header,null,s.a.createElement(S.a.Title,null,"Login")),s.a.createElement(S.a.Body,null,s.a.createElement(y.a,{onSubmit:this.handleSubmit},s.a.createElement(y.a.Group,{controlId:"formGroupUrl"},s.a.createElement(y.a.Label,null,"Server URL"),s.a.createElement(y.a.Control,{type:"text",name:"server",onChange:this.handleChange,defaultValue:this.state.server})),s.a.createElement(y.a.Group,{controlId:"formGroupUser"},s.a.createElement(y.a.Label,null,"Username"),s.a.createElement(y.a.Control,{type:"text",name:"username",onChange:this.handleChange,placeholder:"Username"})),s.a.createElement(y.a.Group,{controlId:"formGroupPass"},s.a.createElement(y.a.Label,null,"Password"),s.a.createElement(y.a.Control,{type:"password",name:"password",onChange:this.handleChange,placeholder:"Password"})),s.a.createElement(E.a,{variant:"primary",type:"submit"},"Submit"))))}}]),t}(s.a.Component),k=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={message:""},a.handleChange=a.handleChange.bind(Object(h.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"handleChange",value:function(e){this.setState(Object(f.a)({},e.target.name,e.target.value))}},{key:"handleSubmit",value:function(e){e.preventDefault(),O.message(sessionStorage.url,this.state.message,sessionStorage.token),console.log("Message sent",this.state.message),this.setState({message:""})}},{key:"render",value:function(){return s.a.createElement(g.a,null,s.a.createElement(y.a,{onSubmit:this.handleSubmit},s.a.createElement(y.a.Row,null,s.a.createElement(v.a,null,s.a.createElement(y.a.Control,{type:"text",name:"message",disabled:this.props.disabled,value:this.state.message,onChange:this.handleChange,placeholder:"Type a message..."})),s.a.createElement(E.a,{variant:"primary",type:"submit",disabled:this.props.disabled},"Send"))))}}]),t}(s.a.Component),C=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).scrollToBottom=function(){a.messagesEnd.scrollIntoView({behavior:"smooth"})},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.scrollToBottom()}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this;return s.a.createElement(g.a,{style:{maxHeight:"60%",overflowY:"auto",height:"600px"}},s.a.createElement("div",{className:"messages"},s.a.createElement("ul",null,this.props.history.map((function(e,t){return s.a.createElement("li",{key:t,className:"Message"===e.event?"message":"status"},s.a.createElement("p",{className:"Message"===e.event?"bg-primary text-white":"none"},e.content))})))),s.a.createElement("div",{style:{float:"left",clear:"both"},ref:function(t){e.messagesEnd=t}}))}}]),t}(s.a.Component),L=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return s.a.createElement(g.a,null,Array.from(this.props.users).map((function(e,t){return s.a.createElement(m.a,{pill:!0,variant:"light",style:{margin:"1em"},key:t},e)})))}}]),t}(s.a.Component),J={formatJoin:function(e){return{event:"Join",content:D(e.created)+" JOIN: "+e.user}},formatMessage:function(e){return{event:"Message",content:D(e.created)+" ("+e.user+") "+e.message}},formatPart:function(e){return{event:"Part",content:D(e.created)+" PART: "+e.user}},formatServerStatus:function(e){return{event:"ServerStatus",content:D(e.created)+" STATUS: "+e.status}}};function D(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")}var U=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={showLoginForm:!0,online:!1,eventSource:null,users:new Set,history:[]},a.startStream=a.startStream.bind(Object(h.a)(a)),a.handleDisconnect=a.handleDisconnect.bind(Object(h.a)(a)),a.handleJoin=a.handleJoin.bind(Object(h.a)(a)),a.handleMessage=a.handleMessage.bind(Object(h.a)(a)),a.handlePart=a.handlePart.bind(Object(h.a)(a)),a.handleServerStatus=a.handleServerStatus.bind(Object(h.a)(a)),a.handleUsers=a.handleUsers.bind(Object(h.a)(a)),a.handleError=a.handleError.bind(Object(h.a)(a)),a.handleOpen=a.handleOpen.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"startStream",value:function(){this.setState({showLoginForm:!1});var e=new EventSource(sessionStorage.url+"/stream/"+sessionStorage.token);console.log("NEW stream started with ",sessionStorage.token),e.addEventListener("Disconnect",this.handleDisconnect,!1),e.addEventListener("Join",this.handleJoin,!1),e.addEventListener("Message",this.handleMessage,!1),e.addEventListener("Part",this.handlePart,!1),e.addEventListener("ServerStatus",this.handleServerStatus,!1),e.addEventListener("Users",this.handleUsers,!1),e.addEventListener("error",this.handleError,!1),e.addEventListener("open",this.handleOpen,!1),this.setState({eventSource:e})}},{key:"handleDisconnect",value:function(e){delete sessionStorage.token,delete sessionStorage.url,delete sessionStorage.user,this.state.eventSource.close(),this.setState({history:[],online:!1,showLoginForm:!0}),console.log("sessionStorage: ",sessionStorage.token)}},{key:"handleJoin",value:function(e){var t=JSON.parse(e.data),a=new Set(this.state.users);a.add(t.user),console.log(t),this.setState({users:a,history:this.state.history.concat([J.formatJoin(t)])})}},{key:"handleMessage",value:function(e){var t=JSON.parse(e.data);console.log(t),this.setState({history:this.state.history.concat([J.formatMessage(t)])})}},{key:"handlePart",value:function(e){var t=JSON.parse(e.data),a=new Set(this.state.users);a.delete(t.user),console.log(t),this.setState({users:a,history:this.state.history.concat([J.formatPart(t)])})}},{key:"handleServerStatus",value:function(e){var t=JSON.parse(e.data);console.log(t),this.setState({history:this.state.history.concat([J.formatServerStatus(t)])})}},{key:"handleUsers",value:function(e){console.log(e);var t=JSON.parse(e.data);this.setState({users:new Set(t.users)})}},{key:"handleError",value:function(e){this.setState({online:!1}),2===e.target.readyState?(delete sessionStorage.token,delete sessionStorage.url,delete sessionStorage.user,this.setState({history:[]})):console.log("Disconnected, retrying")}},{key:"handleOpen",value:function(e){this.setState({online:!0})}},{key:"render",value:function(){return s.a.createElement(g.a,{className:"App"},s.a.createElement(p.a,null,s.a.createElement(v.a,{sm:12},s.a.createElement(b.a,{bg:"light"},s.a.createElement(b.a.Brand,null,"CS291A Chat Room"),s.a.createElement(m.a,{variant:this.state.online?"success":"danger"},this.state.online?"Online":"Offline"),s.a.createElement(b.a.Collapse,{className:"justify-content-end"},s.a.createElement(b.a.Text,{hidden:!this.state.online},"Logged in as: ",s.a.createElement("span",{className:"font-weight-bold"},sessionStorage.user)))))),s.a.createElement(p.a,null,s.a.createElement(v.a,{sm:12},s.a.createElement(S.a.Dialog,{size:"lg",className:"bg-light"},s.a.createElement(S.a.Header,null,s.a.createElement(g.a,null,s.a.createElement(p.a,null,"Online Users"),s.a.createElement(p.a,null,s.a.createElement(L,{users:this.state.users})))),s.a.createElement(S.a.Body,null,s.a.createElement(C,{history:this.state.history})),s.a.createElement(S.a.Footer,null,s.a.createElement(k,{disabled:!this.state.online}))))),s.a.createElement(w,{show:this.state.showLoginForm,startStream:this.startStream}))}}]),t}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(U,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[53,1,2]]]);
//# sourceMappingURL=main.77e43a7d.chunk.js.map